{% extends 'base.html' %}

{% block title %}Editar {{ client.name }} - PIE IV Dashboard{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3 mb-0">
    <i class="fas fa-edit me-2"></i>
    Editar Cliente
  </h1>
  <div>
    <a
      href="{% url 'dashboard:client_detail' client.id %}"
      class="btn btn-info"
    >
      <i class="fas fa-eye me-1"></i>
      Visualizar
    </a>
    <a href="{% url 'dashboard:client_list' %}" class="btn btn-secondary">
      <i class="fas fa-arrow-left me-1"></i>
      Voltar
    </a>
  </div>
</div>

<div class="row justify-content-center">
  <div class="col-md-10 col-lg-8">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="fas fa-user me-2"></i>
          Editando: {{ client.name }}
        </h5>
      </div>
      <div class="card-body">
        <form
          method="post"
          action="{% url 'dashboard:client_edit' client.id %}"
        >
          {% csrf_token %}

          <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Dica:</strong> Preencha apenas os campos que deseja alterar.
            Campos vazios não serão modificados.
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="name" class="form-label">
                <i class="fas fa-user me-2"></i>Nome Completo
              </label>
              <input
                type="text"
                class="form-control"
                id="name"
                name="name"
                placeholder="{{ client.name }}"
                value="{{ request.POST.name|default:'' }}"
              />
              <div class="form-text">
                Deixe vazio para manter: {{ client.name }}
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label for="email" class="form-label">
                <i class="fas fa-envelope me-2"></i>Novo Email
              </label>
              <input
                type="email"
                class="form-control"
                id="email"
                name="email"
                placeholder="{{ client.email }}"
                value="{{ request.POST.email|default:'' }}"
              />
              <div class="form-text">
                Deixe vazio para manter: {{ client.email }}
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for="password" class="form-label">
              <i class="fas fa-lock me-2"></i>Nova Senha
            </label>
            <input
              type="password"
              class="form-control"
              id="password"
              name="password"
              placeholder="Deixe vazio para manter a atual"
              minlength="6"
            />
            <div class="form-text">
              Digite uma nova senha apenas se quiser alterá-la. Mínimo 6
              caracteres.
            </div>
          </div>

          <hr />

          {% if bot_info %}
          <h6 class="mb-3">
            <i class="fas fa-robot me-2"></i>
            Configurações do Bot
          </h6>

          <div class="mb-3">
            <label for="system_prompt" class="form-label">
              <i class="fas fa-comment-dots me-2"></i>Prompt do Sistema
            </label>
            <textarea
              class="form-control"
              id="system_prompt"
              name="system_prompt"
              rows="4"
              placeholder="Digite um novo prompt se quiser alterar"
            >
{{ request.POST.system_prompt|default:bot_info.system_prompt }}</textarea
            >
            <div class="form-text">
              Define como o bot se comporta e responde aos clientes.
            </div>
          </div>

          <div class="alert alert-success">
            <i class="fas fa-check-circle me-2"></i>
            Este cliente possui um bot ativo (ID: {{ bot_info.id }})
          </div>
          {% else %}
          <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle me-2"></i>
            Este cliente não possui um bot configurado. Entre em contato com o
            suporte para criar um.
          </div>
          {% endif %}

          <hr />

          <div class="row">
            <div class="col-md-6">
              <div class="card bg-light">
                <div class="card-body">
                  <h6 class="card-title">
                    <i class="fas fa-info-circle text-info me-2"></i>
                    Status Atual
                  </h6>
                  {% if not client.disabled %}
                  <span class="badge bg-success">
                    <i class="fas fa-check-circle me-1"></i>Ativo
                  </span>
                  {% else %}
                  <span class="badge bg-danger">
                    <i class="fas fa-times-circle me-1"></i>Inativo
                  </span>
                  {% endif %}
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card bg-light">
                <div class="card-body">
                  <h6 class="card-title">
                    <i class="fas fa-hashtag text-primary me-2"></i>
                    ID do Cliente
                  </h6>
                  <span class="badge bg-primary fs-6">{{ client.id }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="d-grid gap-2 mt-4">
            <button type="submit" class="btn btn-warning btn-lg">
              <i class="fas fa-save me-2"></i>
              Salvar Alterações
            </button>
            <a
              href="{% url 'dashboard:client_detail' client.id %}"
              class="btn btn-outline-secondary"
            >
              <i class="fas fa-times me-1"></i>
              Cancelar
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}
