{% extends 'base.html' %}

{% block title %}Criar Cliente - PIE IV Dashboard{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3 mb-0">
    <i class="fas fa-user-plus me-2"></i>
    Criar Cliente
  </h1>
  <a href="{% url 'dashboard:client_list' %}" class="btn btn-secondary">
    <i class="fas fa-arrow-left me-1"></i>
    Voltar
  </a>
</div>

<div class="row justify-content-center">
  <div class="col-md-10 col-lg-8">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="fas fa-info-circle me-2"></i>
          Informações do Cliente
        </h5>
      </div>
      <div class="card-body">
        <form method="post" action="{% url 'dashboard:client_create' %}">
          {% csrf_token %}

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="name" class="form-label">
                <i class="fas fa-user me-2"></i>Nome Completo *
              </label>
              <input
                type="text"
                class="form-control"
                id="name"
                name="name"
                required
                placeholder="João Silva"
                value="{{ request.POST.name|default:'' }}"
              />
              <div class="form-text">Nome completo do cliente.</div>
            </div>

            <div class="col-md-6 mb-3">
              <label for="email" class="form-label">
                <i class="fas fa-envelope me-2"></i>Email *
              </label>
              <input
                type="email"
                class="form-control"
                id="email"
                name="email"
                required
                placeholder="cliente@exemplo.com"
                value="{{ request.POST.email|default:'' }}"
              />
              <div class="form-text">
                O email será usado para login do cliente.
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="password" class="form-label">
                <i class="fas fa-lock me-2"></i>Senha *
              </label>
              <input
                type="password"
                class="form-control"
                id="password"
                name="password"
                required
                placeholder="Digite uma senha segura"
                minlength="6"
              />
              <div class="form-text">
                A senha deve ter pelo menos 6 caracteres.
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label for="confirm_password" class="form-label">
                <i class="fas fa-lock me-2"></i>Confirmar Senha *
              </label>
              <input
                type="password"
                class="form-control"
                id="confirm_password"
                name="confirm_password"
                required
                placeholder="Digite a senha novamente"
                minlength="6"
              />
            </div>
          </div>

          <hr />

          <div class="mb-3">
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                id="create_bot"
                name="create_bot"
                checked
              />
              <label class="form-check-label" for="create_bot">
                <i class="fas fa-robot me-2"></i>
                <strong>Criar Bot com IA para este cliente</strong>
              </label>
            </div>
            <small class="text-muted">
              Ao marcar esta opção, um bot personalizado com IA será criado
              automaticamente para o cliente.
            </small>
          </div>

          <div id="bot_config" class="mb-3">
            <label for="system_prompt" class="form-label">
              <i class="fas fa-comment-dots me-2"></i>Prompt do Sistema
              (Personalidade do Bot)
            </label>
            <textarea
              class="form-control"
              id="system_prompt"
              name="system_prompt"
              rows="4"
              placeholder="Ex: Você é um assistente virtual prestativo que ajuda clientes com informações sobre produtos e serviços..."
            >
{{ request.POST.system_prompt|default:'Você é um assistente virtual prestativo e profissional. Responda de forma clara e objetiva às perguntas dos usuários.' }}</textarea
            >
            <div class="form-text">
              Este texto define como o bot se comportará e responderá aos
              clientes.
            </div>
          </div>

          <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Informação:</strong> O cliente poderá fazer login no portal
            e ver as informações do seu bot.
          </div>

          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary btn-lg">
              <i class="fas fa-save me-2"></i>
              Criar Cliente
            </button>
            <a
              href="{% url 'dashboard:client_list' %}"
              class="btn btn-outline-secondary"
            >
              <i class="fas fa-times me-1"></i>
              Cancelar
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const password = document.getElementById("password");
    const confirmPassword = document.getElementById("confirm_password");
    const createBot = document.getElementById("create_bot");
    const botConfig = document.getElementById("bot_config");
    const systemPrompt = document.getElementById("system_prompt");

    function validatePassword() {
      if (password.value !== confirmPassword.value) {
        confirmPassword.setCustomValidity("As senhas não coincidem");
      } else {
        confirmPassword.setCustomValidity("");
      }
    }

    function toggleBotConfig() {
      if (createBot.checked) {
        botConfig.style.display = "block";
        systemPrompt.required = true;
      } else {
        botConfig.style.display = "none";
        systemPrompt.required = false;
      }
    }

    password.addEventListener("change", validatePassword);
    confirmPassword.addEventListener("keyup", validatePassword);
    createBot.addEventListener("change", toggleBotConfig);

    // Initialize
    toggleBotConfig();
  });
</script>
{% endblock %}
